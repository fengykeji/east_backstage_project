<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta charset="utf-8"/>
    <title>客户管理</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>


    <!-- bootstrap & fontawesome -->
    <link rel="stylesheet" href="assets/css/bootstrap.css"/>
    <link rel="stylesheet" href="components/font-awesome/css/font-awesome.css"/>

    <!-- text fonts -->
    <link rel="stylesheet" href="assets/css/ace-fonts.css"/>

    <!-- ace styles -->
    <link rel="stylesheet" href="assets/css/ace.css" class="ace-main-stylesheet" id="main-ace-style"/>


    <link rel="stylesheet" href="assets/css/ace-skins.css"/>
    <link rel="stylesheet" href="assets/css/ace-rtl.css"/>


    <!-- ace settings handler -->
    <script src="assets/js/ace-extra.js"></script>


    <style>
        #dynamic-table td {
            vertical-align: middle;
        }

        .paginate_button,
        a {
            cursor: pointer;
        }

        .modal_today, .modal_fenxiao {
            display: none;
            background-color: rgba(0, 0, 0, .5);
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
    </style>
</head>

<body class="no-skin">
<div id="header"></div>
<!-- /section:basics/navbar.layout -->
<div class="main-container" id="main-container">
    <script type="text/javascript">
        try {
            ace.settings.check('main-container', 'fixed')
        } catch (e) {
        }
    </script>

    <!-- 菜单开始 -->
    <div id="sidebar" class="sidebar responsive ace-save-state">

    </div>

    <!-- /section:basics/sidebar -->
    <div class="main-content">
        <div class="main-content-inner">
            <div class="breadcrumbs" id="breadcrumbs">
                <script type="text/javascript">
                    try {
                        ace.settings.check('breadcrumbs', 'fixed')
                    } catch (e) {
                    }
                </script>
                <ul class="breadcrumb">
                    <li>
                        <i class="ace-icon fa fa-home home-icon"></i>
                        <a href="CustomerManagement.html">楼盘字典>客户管理</a>
                    </li>
                </ul>
            </div>
            <!-- 内容开始 -->
            <div class="page-content">
                <div class="row" style="margin-top: 50px;">
                    <div class="col-lg-6 col-xs-12">
                        <div class="widget-box ys">
                            <div class="widget-header" style="position: relative;">
                                <h4 class="smaller" style="display: inline-block;">客户统计图</h4>
                            </div>
                            <div class="widget-body">
                                <div class="widget-main" style="overflow: hidden;">
                                    <div class="col-xs-6">
                                        <div id="CusStatAll" style="width: 100%;height:400px;"></div>
                                    </div>
                                    <div class="col-xs-6">
                                        <div id="CusStatMon" style="width: 100%;height:400px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 col-xs-12" style="min-height: 200px;">
                        <div class="widget-box ys">
                            <div class="widget-header" style="position: relative;">
                                <h4 class="smaller" style="display: inline-block;">今日推荐客户</h4>
                                <a id="todayRem"
                                   style="float: right;display: inline-block;height: 38px;line-height: 38px;margin-right: 15px;">查看更多</a>
                            </div>
                            <div class="widget-body">
                                <div class="widget-main" style="overflow: hidden;">
                                    <div class="col-xs-12">
                                        <div>
                                            <div id="dynamic-table_wrapper"
                                                 class="dataTables_wrapper form-inline no-footer">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="margin-top: 50px;">
                    <div class="col-lg-6 col-xs-12">
                        <div class="widget-box ys">
                            <div class="widget-header" style="position: relative;">
                                <h4 class="smaller" style="display: inline-block;">渠道来源分析图</h4>
                            </div>
                            <div class="widget-body">
                                <div class="widget-main" style="overflow: hidden;">
                                    <div class="col-xs-12">
                                        <div id="ChanAls" style="width: 100%;height:400px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 col-xs-12" style="min-height: 200px;">
                        <div class="widget-box ys">
                            <div class="widget-header" style="position: relative;">
                                <h4 class="smaller" style="display: inline-block;">分销公司排行榜</h4>
                                <a id="fenxiao"
                                   style="float: right;display: inline-block;height: 38px;line-height: 38px;margin-right: 15px;">查看更多</a>
                            </div>
                            <div class="widget-body">
                                <div class="widget-main" style="overflow: hidden;">
                                    <div class="col-xs-12">
                                        <div>
                                            <div id="dynamic-table_fenxiao"
                                                 class="dataTables_wrapper form-inline no-footer">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="margin-top: 50px;">
                    <div class="widget-box ys">
                        <div class="widget-header" style="position: relative;">
                            <h4 class="smaller" style="display: inline-block;">年度统计图</h4>
                            <select name="years" id="years" style="margin-left: 10px;"></select>
                        </div>
                        <div class="widget-body">
                            <div class="widget-main" style="overflow: hidden;min-height: 200px;">
                                <div class="col-xs-12" id="yearDiv">
                                    <div id="AnlStat" style="width: 100%;height:400px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal_today">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="bootbox-close-button close closed">×</button>
                <h4 class="modal-title">今日推荐客户</h4>
            </div>
            <div class="modal-body">
                <div class="bootbox-body" style="overflow: hidden;font-size: 14px;text-align: left;">
                    <div class="col-xs-12" style="overflow-y: scroll;height: 100%;">
                        <div id="dynamic-table_todays" class="dataTables_wrapper form-inline no-footer">

                            <table class="table table-striped table-bordered table-hover dataTable no-footer"
                                   role="grid" aria-describedby="dynamic-table_info">
                                <thead>
                                    <tr role="row">
                                        <th class="center">客户名称</th>
                                        <th class="center">电话号码</th>
                                        <th class="center">类型</th>
                                        <th class="center">推荐人</th>
                                        <th class="center">失效时间</th>
                                    </tr>
                                </thead>
                                <tbody id="today_list">

                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button data-bb-handler="confirm" type="button" class="btn btn-sm btn-primary closed">关闭</button>
            </div>
        </div>
    </div>
</div>
<div class="modal_fenxiao">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="bootbox-close-button close closed">×</button>
                <h4 class="modal-title">分销公司排行榜</h4>
            </div>
            <div class="modal-body">
                <div class="bootbox-body" style="overflow: hidden;font-size: 14px;text-align: left;">
                    <div class="col-xs-12" style="overflow-y: scroll;height: 100%;">
                        <div id="dynamic-table_fenxiaos" class="dataTables_wrapper form-inline no-footer">

                            <table id="" class="table table-striped table-bordered table-hover dataTable no-footer"
                                   role="grid" aria-describedby="dynamic-table_info">
                                <thead>
                                <tr role="row">
                                    <th class="center">公司名称</th>
                                    <th class="center">推荐数量</th>
                                </tr>
                                </thead>
                                <tbody id="fenxiao_list">

                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button data-bb-handler="confirm" type="button" class="btn btn-sm btn-primary closed">关闭</button>
            </div>
        </div>
    </div>
</div>
<!-- basic scripts -->

<!--[if !IE]> -->
<script src="components/jquery/dist/jquery.js"></script>
<script type="text/javascript">
    if ('ontouchstart' in document.documentElement) document.write(
        "<script src='components/_mod/jquery.mobile.custom/jquery.mobile.custom.js'>" + "<" + "/script>");
</script>
<script src="components/bootstrap/dist/js/bootstrap.js"></script>

<!-- ace scripts -->
<script src="assets/js/src/elements.scroller.js"></script>
<script src="assets/js/src/elements.colorpicker.js"></script>
<script src="assets/js/src/elements.fileinput.js"></script>
<script src="assets/js/src/elements.typeahead.js"></script>
<script src="assets/js/src/elements.wysiwyg.js"></script>
<script src="assets/js/src/elements.spinner.js"></script>
<script src="assets/js/src/elements.treeview.js"></script>
<script src="assets/js/src/elements.wizard.js"></script>
<script src="assets/js/src/elements.aside.js"></script>
<script src="assets/js/src/ace.js"></script>
<script src="assets/js/src/ace.basics.js"></script>
<script src="assets/js/src/ace.scrolltop.js"></script>
<script src="assets/js/src/ace.ajax-content.js"></script>
<script src="assets/js/src/ace.touch-drag.js"></script>
<script src="assets/js/src/ace.sidebar.js"></script>
<script src="assets/js/src/ace.sidebar-scroll-1.js"></script>
<script src="assets/js/src/ace.submenu-hover.js"></script>
<script src="assets/js/src/ace.widget-box.js"></script>
<script src="assets/js/src/ace.settings.js"></script>
<script src="assets/js/src/ace.settings-rtl.js"></script>
<script src="assets/js/src/ace.settings-skin.js"></script>
<script src="assets/js/src/ace.widget-on-reload.js"></script>
<script src="assets/js/src/ace.searchbox-autocomplete.js"></script>
<!-- 本页js -->
<script src="assets/js/jquery.cookie.js"></script>
<script src="assets/js/config.js"></script>
<script src="assets/js/public.js"></script>
<script src="assets/js/echarts.js"></script>
<!--菜单初始化-->
<script>
    window.onload = function () {
        $('#header').load('public/header.html');
        $('#sidebar').load('public/menu.html');
        var menu_data = {
            opening: '',
            acting: '.kehuguanli'
        }
        $.cookie('menu_data', JSON.stringify(menu_data), {
            path: "menu.html"
        });
    }
</script>
<!--获取数据-->
<script>
    var date = new Date;
    var year = date.getFullYear();

    ajax.get('project/client/count', {year: year}, function (res) {
        var Data = res.data;
        fenxiao(Data.company);
        today(Data.currentDay);
        yearStat(Data.yearCount);
        ChanAl(Data.source);
        monthStat(Data.currentMonthCount);
        allStat(Data.totalCount);
    })


    //
    <!--分销公司排行榜-->
    function fenxiao(arr) {
        if (arr.length == 0) {
            var notData = '<p style="text-align: center;font-size: 15px;">暂无数据</p>';
            $('#dynamic-table_fenxiao').append(notData);
            $('#fenxiao').hide();
        }
        else {
            $('#fenxiao').show();
            var str1 = '';
            var str2 = '';
            for (var i = 0; i < arr.length; i++) {
                str1 += '<tr><td class="center">' + arr[i].name + '</td>' +
                    '<td class="center">' + arr[i].recommendNum + '</td></tr>';
            }
            $('#fenxiao_list').append(str1);
            var n = 5;
            if (arr.length < n) {
                n = arr.length;
                $('#fenxiao').hide();
            }
            for (var i = 0; i < n; i++) {
                str2 += '<tr><td class="center">' + arr[i].name + '</td>' +
                    '<td class="center">' + arr[i].recommendNum + '</td></tr>';
            }
            var todayCus = '<table id="" class="table table-striped table-bordered table-hover dataTable no-footer" role="grid" aria-describedby="dynamic-table_info">' +
                '<thead>' +
                '<tr role="row">' +
                '<th class="center">公司名称</th>' +
                '<th class="center">推荐数量</th>' +
                '</tr>' +
                '</thead>' +
                '<tbody id="build_list1">' + str2 + '</tbody>' +
                '</table>';
            $('#dynamic-table_fenxiao').append(todayCus);
        }
    }


    //
    <!--今日推荐客户-->
    function today(arr) {
        if (arr.length == 0) {
            var notData = '<p style="text-align: center;font-size: 15px;">暂无数据</p>';
            $('#dynamic-table_wrapper').append(notData);
            $('#todayRem').hide();
        } else {
            $('#todayRem').show();
            var str1 = '';
            var str2 = '';
            for (var i = 0; i < arr.length; i++) {
                str1 += '<tr><td class="center">' + arr[i].name + '</td>' +
                    '<td class="center">' + arr[i].tel + '</td>' +
                    '<td class="center">' + arr[i].rule_type + '</td>' +
                    '<td class="center">' + arr[i].broker_agent_name + '</td>' +
                    '<td class="center">' + arr[i].end_time + '</td></tr>';
            }
            $('#today_list').append(str1);
            var n = 5;
            if (arr.length < n) {
                n = arr.length;
                $('#todayRem').hide();
            }
            for (var i = 0; i < n; i++) {
                str2 += '<tr><td class="center">' + arr[i].name + '</td>' +
                    '<td class="center">' + arr[i].tel + '</td>' +
                    '<td class="center">' + arr[i].rule_type + '</td>' +
                    '<td class="center">' + arr[i].broker_agent_name + '</td>' +
                    '<td class="center">' + arr[i].end_time + '</td></tr>';
            }
            var todayCus = '<table id="" class="table table-striped table-bordered table-hover dataTable no-footer" role="grid" aria-describedby="dynamic-table_info">' +
                '<thead>' +
                '<tr role="row">' +
                '<th class="center">客户名称</th>' +
                '<th class="center">电话号码</th>' +
                '<th class="center">类型</th>' +
                '<th class="center">推荐人</th>' +
                '<th class="center">失效时间</th>' +
                '</tr>' +
                '</thead>' +
                '<tbody id="build_list2">' + str2 + '</tbody>' +
                '</table>';
            $('#dynamic-table_wrapper').append(todayCus);
        }
    }

    //
    <!--年度统计图-->
    function yearStat(datas) {
        var str = '';
        var num = 0;
        var months = [];
        var recommends = [];//推荐
        var visits = [];//到访
        var deals = [];//成交
        var notData = '<p style="text-align: center;font-size: 15px;">暂无数据</p>';
        for (var i = 0; i < 10; i++) {
            num = parseInt(datas.year - i);
            str += '<option value="' + num + '">' + num + '年</option>'
        }
        $('#years').append(str);


        if (datas.count.list.length == 0) {
            $('#yearDiv').append(notData);
            $('#AnlStat').hide();
        } else {
            $('#AnlStat').show();
            for (var i = 0; i < datas.count.list.length; i++) {
                months.push(datas.count.list[i].month + '月');
                recommends.push(datas.count.list[i].count.recommend);
                visits.push(datas.count.list[i].count.visit);
                deals.push(datas.count.list[i].count.deal);
            }
        }


        var dom = document.getElementById("AnlStat");
        var myChart = echarts.init(dom);
        option = null;
        option = {
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                data: ['推荐客户', '到访客户', '成交客户']
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: months
            },
            yAxis: {
                type: 'value'
            },
            series: [
                {
                    name: '推荐客户',
                    type: 'line',
                    // stack: '总量',
                    data: recommends
                },
                {
                    name: '到访客户',
                    type: 'line',
                    // stack: '总量',
                    data: visits
                },
                {
                    name: '成交客户',
                    type: 'line',
                    // stack: '总量',
                    data: deals
                }
            ]
        };

        myChart.setOption(option);
    }

    //
    <!--渠道来源分析图-->
    function ChanAl(datas) {
        // console.log(datas)
        var qudao = [];
        var recommends = [];//推荐
        var visits = [];//到访
        var deals = [];//成交
        for (var i = 0; i < datas.length; i++) {
            qudao.push(datas[i].name);
            recommends.push(datas[i].count.recommend);
            visits.push(datas[i].count.visit);
            deals.push(datas[i].count.deal);
        }

        var dom = document.getElementById("ChanAls");
        var myChart = echarts.init(dom);
        var app = {};
        option = null;
        app.config = {
            rotate: 90,
            align: 'left',
            verticalAlign: 'middle',
            position: 'insideBottom',
            distance: 15,
            onChange: function () {
                var labelOption = {
                    normal: {
                        rotate: app.config.rotate,
                        align: app.config.align,
                        verticalAlign: app.config.verticalAlign,
                        position: app.config.position,
                        distance: app.config.distance
                    }
                };
                myChart.setOption({
                    series: [{
                        label: labelOption
                    }, {
                        label: labelOption
                    }, {
                        label: labelOption
                    }, {
                        label: labelOption
                    }]
                });
            }
        };


        var labelOption = {
            normal: {
                show: false,
                position: app.config.position,
                distance: app.config.distance,
                align: app.config.align,
                verticalAlign: app.config.verticalAlign,
                rotate: app.config.rotate,
                formatter: '{c}  {name|{a}}',
                fontSize: 16,
                rich: {
                    name: {
                        textBorderColor: '#fff'
                    }
                }
            }
        };

        option = {
            color: ['#006699', '#4cabce', '#e5323e'],
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                }
            },
            legend: {
                data: ['推荐客户', '到访客户', '成交客户']
            },
            toolbox: {
                show: true,
                orient: 'vertical',
                left: 'right',
                top: 'center'
            },
            calculable: true,
            xAxis: [
                {
                    type: 'category',
                    axisTick: {show: false},
                    data: qudao
                }
            ],
            yAxis: [
                {
                    type: 'value'
                }
            ],
            series: [
                {
                    name: '推荐客户',
                    type: 'bar',
                    label: labelOption,
                    data: recommends
                },
                {
                    name: '到访客户',
                    type: 'bar',
                    label: labelOption,
                    data: visits
                },
                {
                    name: '成交客户',
                    type: 'bar',
                    label: labelOption,
                    data: deals
                }
            ]
        };
        myChart.setOption(option);
    }

    //
    <!--客户统计-->
    function monthStat(datas) {//本月
        var kehu = [
            // {value: datas.total*10, name: '全部客户'+datas.total,href:'RemCus.html?CusType=1'},
            {value: datas.recommend * 100, name: '推荐客户' + datas.recommend,href:'RemCus.html?CusType=3'},
            {value: datas.visit * 100, name: '到访客户' + datas.visit,href:'RemCus.html?CusType=4'},
            {value: datas.deal * 100, name: '成交客户' + datas.deal,href:'RemCus.html?CusType=5'}
        ]


        var dom = document.getElementById("CusStatMon");
        var myChart = echarts.init(dom);
        option = null;
        option = {
            title: {
                text: '本月客户',
                subtext: ''
            },
            calculable: true,
            series: [
                {
                    name: '漏斗图',
                    type: 'funnel',
                    left: '10%',
                    top: 60,
                    bottom: 60,
                    width: '80%',
                    min: 10,
                    max: 100,
                    minSize: '20%',
                    maxSize: '100%',
                    sort: 'descending',
                    gap: 2,
                    label: {
                        normal: {
                            show: true,
                            position: 'inside'
                        },
                        emphasis: {
                            textStyle: {
                                fontSize: 18
                            }
                        }
                    },
                    labelLine: {
                        normal: {
                            length: 10,
                            lineStyle: {
                                width: 1,
                                type: 'solid'
                            }
                        }
                    },
                    itemStyle: {
                        normal: {
                            borderColor: '#fff',
                            borderWidth: 1
                        }
                    },
                    data: kehu
                }
            ]
        };
        myChart.setOption(option);
        myChart.on('click', function (params) {
            window.location=params.data.href;

        });
    }

    function allStat(datas) {//全部
        var kehu = [
            // {value: datas.total*10, name: '全部客户'+datas.total,href:'RemCus.html?CusType=1'},
            {value: datas.recommend * 100, name: '推荐客户' + datas.recommend,href:'RemCus.html?CusType=3'},
            {value: datas.visit * 100, name: '到访客户' + datas.visit,href:'RemCus.html?CusType=4'},
            {value: datas.deal * 100, name: '成交客户' + datas.deal,href:'RemCus.html?CusType=5'}
        ]

        var dom = document.getElementById("CusStatAll");
        var myChart = echarts.init(dom);
        option = null;
        option = {
            title: {
                text: '所有客户',
                subtext: ''
            },
            calculable: true,
            series: [
                {
                    name: '漏斗图',
                    type: 'funnel',
                    left: '10%',
                    top: 60,
                    bottom: 60,
                    width: '80%',
                    min: 10,
                    max: 100,
                    minSize: '10%',
                    maxSize: '100%',
                    sort: 'descending',
                    gap: 2,
                    label: {
                        normal: {
                            show: true,
                            position: 'inside'
                        },
                        emphasis: {
                            textStyle: {
                                fontSize: 18
                            }
                        }
                    },
                    labelLine: {
                        normal: {
                            length: 10,
                            lineStyle: {
                                width: 1,
                                type: 'solid'
                            }
                        }
                    },
                    itemStyle: {
                        normal: {
                            borderColor: '#fff',
                            borderWidth: 1
                        }
                    },
                    data: kehu
                }
            ]
        };
        myChart.setOption(option);
        myChart.on('click', function (params) {
            window.location=params.data.href;
        });
    }
</script>
<!--操作-->
<script>
    $('#todayRem').on('click', function () {
        $('.modal_today').show();
    })
    $('#fenxiao').on('click', function () {
        $('.modal_fenxiao').show();
    })
    $('#years').on('change', function () {
        ajax.get('project/client/count', {year: $(this).val()}, function (res) {
            var Data = res.data;
            yearStat(Data.yearCount);
        })
    })
    $('.closed').on('click', function () {
        $(this).parent().parent().parent().parent().hide();
    })
</script>


</body>

</html>