<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta charset="utf-8"/>
    <title>佣金管理</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>


    <!-- bootstrap & fontawesome -->
    <link rel="stylesheet" href="assets/css/bootstrap.css"/>
    <link rel="stylesheet" href="components/font-awesome/css/font-awesome.css"/>

    <!-- text fonts -->
    <link rel="stylesheet" href="assets/css/ace-fonts.css"/>

    <!-- ace styles -->
    <link rel="stylesheet" href="assets/css/ace.css" class="ace-main-stylesheet" id="main-ace-style"/>


    <link rel="stylesheet" href="assets/css/ace-skins.css"/>
    <link rel="stylesheet" href="assets/css/ace-rtl.css"/>


    <!-- ace settings handler -->
    <script src="assets/js/ace-extra.js"></script>


    <style>
        #dynamic-table td {
            vertical-align: middle;
        }

        .paginate_button,
        a {
            cursor: pointer;
        }

        .modal_tuijian, .modal_success, .modal_daofang {
            display: none;
            background-color: rgba(0, 0, 0, .5);
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .btn-xs, .btn-group-xs > .btn {
            padding-top: 3px;
            padding-bottom: 3px;
            border-width: 3px;
            margin-top: -3px;
        }

        .searchInp {
            height: 30px;
            width: 200px;
        }

        .inpt_width {
            width: 70%;
        }

        .lab_width {
            width: 100px;
        }
    </style>
</head>

<body class="no-skin">
<div id="header"></div>
<!-- /section:basics/navbar.layout -->
<div class="main-container" id="main-container">
    <script type="text/javascript">
        try {
            ace.settings.check('main-container', 'fixed')
        } catch (e) {
        }
    </script>

    <!-- 菜单开始 -->
    <div id="sidebar" class="sidebar responsive ace-save-state">

    </div>

    <!-- /section:basics/sidebar -->
    <div class="main-content">
        <div class="main-content-inner">
            <div class="breadcrumbs" id="breadcrumbs">
                <script type="text/javascript">
                    try {
                        ace.settings.check('breadcrumbs', 'fixed')
                    } catch (e) {
                    }
                </script>
                <ul class="breadcrumb">
                    <li>
                        <i class="ace-icon fa fa-home home-icon"></i>
                        <a href="comsionComList.html">佣金管理>公司佣金列表</a>
                        <a>>累计列表</a>
                    </li>
                </ul>
            </div>
            <!-- 内容开始 -->
            <div class="page-content">
                <div class="row">
                    <div class="col-xs-12">
                        <!--搜索框-->
                        <div style="margin-bottom: 15px;padding-left:13px;">
                            <button id="daofangBtn" class="btn btn-xs btn-primary"
                                    style="margin-right: 35px;">
                                <trans>条件查询</trans>
                                <i class="ace-icon fa fa-search icon-on-right"></i>
                            </button>
                            <input type="text" id="daofangIpn" class="searchInp" placeholder="请输入客户名称/电话">
                            <button id="daofangSearch" class="btn btn-xs">
                                <i class="ace-icon fa fa-search glyphicon-search"></i>
                            </button>
                        </div>
                        <div id="daofangDiv" class="col-xs-12"
                             style="overflow-x: scroll;min-height: 200px;">

                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>
</div>


<!--到访-->
<div class="modal_daofang">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="bootbox-close-button close closed">×</button>
                <h4 class="modal-title">条件查询</h4>
            </div>
            <div class="modal-body">
                <div class="bootbox-body" style="overflow: hidden;font-size: 14px;text-align: left;">
                    <div class="col-xs-12" style="padding-left: 40px;">
                        <div class="form-group">
                            <label class="lab_width">开始时间：</label>
                            <div class="inpt_width" style="display: inline-block;vertical-align: middle;">
                                <div class="input-group">
                                    <input id="daofangStartTime" class="form-control date-picker" type="text"
                                           data-date-format="yyyy-mm-dd">
                                    <span class="input-group-addon">
                                        <i class="fa fa-calendar bigger-110"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="lab_width">结束时间：</label>
                            <div class="inpt_width" style="display: inline-block;vertical-align: middle;">
                                <div class="input-group">
                                    <input id="daofangEndTime" class="form-control date-picker" type="text"
                                           data-date-format="yyyy-mm-dd">
                                    <span class="input-group-addon">
                                        <i class="fa fa-calendar bigger-110"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="lab_width">公司名称：</label>
                            <select id="daofangComName" class="form-control inpt_width" style="display: inline-block;">

                            </select>
                            <!--</div>-->
                            <!--<div class="form-group">-->
                            <!--<label class="lab_width">置业顾问：</label>-->
                            <!--<select id="daofangGuWen" class="form-control inpt_width" style="display: inline-block;">-->

                            <!--</select>-->
                            <!--</div>-->

                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button data-bb-handler="cancel" type="button" class="btn btn-sm btn-default closed">取消</button>
                    <button data-bb-handler="confirm" type="button" class="btn btn-sm btn-primary" id="daofangSub">确定
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- basic scripts -->

<!--[if !IE]> -->
<script src="components/jquery/dist/jquery.js"></script>
<script type="text/javascript">
    if ('ontouchstart' in document.documentElement) document.write(
        "<script src='components/_mod/jquery.mobile.custom/jquery.mobile.custom.js'>" + "<" + "/script>");
</script>
<script src="components/bootstrap/dist/js/bootstrap.js"></script>

<!-- ace scripts -->
<script src="assets/js/src/elements.scroller.js"></script>
<script src="assets/js/src/elements.colorpicker.js"></script>
<script src="assets/js/src/elements.fileinput.js"></script>
<script src="assets/js/src/elements.typeahead.js"></script>
<script src="assets/js/src/elements.wysiwyg.js"></script>
<script src="assets/js/src/elements.spinner.js"></script>
<script src="assets/js/src/elements.treeview.js"></script>
<script src="assets/js/src/elements.wizard.js"></script>
<script src="assets/js/src/elements.aside.js"></script>
<script src="assets/js/src/ace.js"></script>
<script src="assets/js/src/ace.basics.js"></script>
<script src="assets/js/src/ace.scrolltop.js"></script>
<script src="assets/js/src/ace.ajax-content.js"></script>
<script src="assets/js/src/ace.touch-drag.js"></script>
<script src="assets/js/src/ace.sidebar.js"></script>
<script src="assets/js/src/ace.sidebar-scroll-1.js"></script>
<script src="assets/js/src/ace.submenu-hover.js"></script>
<script src="assets/js/src/ace.widget-box.js"></script>
<script src="assets/js/src/ace.settings.js"></script>
<script src="assets/js/src/ace.settings-rtl.js"></script>
<script src="assets/js/src/ace.settings-skin.js"></script>
<script src="assets/js/src/ace.widget-on-reload.js"></script>
<script src="assets/js/src/ace.searchbox-autocomplete.js"></script>
<!-- 本页js -->
<script src="assets/js/jquery.cookie.js"></script>
<script src="assets/js/config.js"></script>
<script src="assets/js/public.js"></script>
<!--菜单初始化-->
<script>
    window.onload = function () {
        $('#header').load('public/header.html');
        $('#sidebar').load('public/menu.html');
        var menu_data = {
            opening: '.yongjinguanli',
            acting: '.gongsiyongjinList'
        }
        $.cookie('menu_data', JSON.stringify(menu_data), {
            path: "menu.html"
        });
    }
</script>
<script>
    var totalPage = 0;
    daofangPage(1);

    function daofangPage(p) {
        ajax.get('project/broker/company/list', {}, function (res) {
            var Data = res;
            daofang(Data,p);
        })
    }

    function daofang(arr,p) {
        $('#daofangDiv').html('');
        if (arr.data.length == 0) {
            var notData = '<p style="text-align: center;font-size: 15px;padding: 30px;">暂无数据</p>';
            $('daofangDiv').append(notData);
            $('#daofang').hide();
        }
        else {
            $('#daofang').show();
            var str = '';//表格内容
            var num = 0;//序号



            var a={};
            totalPage=Math.ceil(arr.data.length/15);
            a.last_page=Math.ceil(arr.data.length/15);
            a.current_page=p;
            var x='daofang'
            var pageStr = pageFun(a,x);//页数





            if(arr.data.length>p*15){
                for (var i = p*15-15; i < p*15; i++) {
                    num = i + 1;
                    str += '<tr>' +
                        '<td class="center">' + num + '</td>' +
                        '<td class="center">' + arr.data[i].client_id + '</td>' +
                        '<td class="center">' + arr.data[i].project_name + '</td>' +
                        '<td class="center">' + arr.data[i].sell_company_name + '</td>' +
                        '<td class="center">' + arr.data[i].name + '</td>' +
                        '<td class="center">' + arr.data[i].tel + '</td>' +
                        '<td class="center">' + arr.data[i].broker_type + '</td>' +
                        '<td class="center">' + arr.data[i].create_time + '</td>' +
                        '<td class="center">' + arr.data[i].broker_num + '</td>' +
                        '<td class="center">' + arr.data[i].is_pay + '</td>' +
                        '<td class="center">' + arr.data[i].pay_state_name + '</td>' +
                        '</tr>';
                }
            }else{
                for (var i = p*15-15; i < arr.data.length; i++) {
                    num = i + 1;
                    str += '<tr>' +
                        '<td class="center">' + num + '</td>' +
                        '<td class="center">' + arr.data[i].client_id + '</td>' +
                        '<td class="center">' + arr.data[i].project_name + '</td>' +
                        '<td class="center">' + arr.data[i].sell_company_name + '</td>' +
                        '<td class="center">' + arr.data[i].name + '</td>' +
                        '<td class="center">' + arr.data[i].tel + '</td>' +
                        '<td class="center">' + arr.data[i].broker_type + '</td>' +
                        '<td class="center">' + arr.data[i].create_time + '</td>' +
                        '<td class="center">' + arr.data[i].broker_num + '</td>' +
                        '<td class="center">' + arr.data[i].is_pay + '</td>' +
                        '<td class="center">' + arr.data[i].pay_state_name + '</td>' +
                        '</tr>';
                }
            }










            var todayCus = '<div id="daofang" style="width: 1400px;">' +
                '<div  class="dataTables_wrapper form-inline no-footer">' +
                '<table  class="table table-striped table-bordered table-hover dataTable no-footer" role="grid" aria-describedby="dynamic-table_info">' +
                '<thead>' +
                '<tr role="row">' +
                '<th class="center">序号</th>' +
                '<th class="center">推荐编号</th>' +
                '<th class="center">项目名称</th>' +
                '<th class="center">房间号</th>' +
                '<th class="center">经纪人名称</th>' +
                '<th class="center">联系电话</th>' +
                '<th class="center">佣金类型</th>' +
                '<th class="center">时间</th>' +
                '<th class="center">佣金金额（￥）</th>' +
                '<th class="center">计算规则</th>' +
                '<th class="center">状态</th>' +
                '</tr>' +
                '</thead>' +
                '<tbody id="daofang_tb">' + str +
                '</tbody>' +
                '</table>' +
                '<div class="row">' +
                    '<div class="col-xs-6" style="color: #6FAED9;font-weight: bolder;font-size: 15px;">累计金额：100 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;累计笔数：100</div>'+
                '<div class="col-xs-6">' +
                '<div class="dataTables_paginate paging_simple_numbers" >' +
                '<ul class="pagination">' +
                '<li class="paginate_button previous" aria-controls="dynamic-table" tabindex="0" id="prev_daofang">' +
                '<a>首页</a></li>' +pageStr+
                '<li class="paginate_button next" aria-controls="dynamic-table" tabindex="0" id="next_daofang"><a>尾页</a></li>' +
                '</ul></div></div></div></div></div>';
            $('#daofangDiv').append(todayCus);
        }
    }
    $(document).on('click', '.daofangPageClick', function () {
        daofangPage($(this).text());
        return false;
    })
    $(document).on('click', '#prev_daofang', function () {
        daofangPage(1);
        return false;
    })
    $(document).on('click', '#next_daofang', function () {
        daofangPage(totalPage);
        return false;
    })
</script>
<!--操作-->
<script>
    //到访
    $('#daofangBtn').on('click', function () {
        PartyB($('#daofangComName'));
        zhiye($('#daofangGuWen'));
        $('.modal_daofang').show();
        return false;
    })

    $('#daofangSub').on('click', function () {
        var st = $('#daofangStartTime').val();
        var et = $('#daofangEndTime').val();
        var cn = $('#daofangComName').val();
        var gw = $('#daofangGuWen').val();
        var data = {
            start_time: st,
            end_time: et,
            company_id: cn,
            advice_name: gw,
        }
        console.log(data);
        ajax.get('project/client/value', data, function (res) {
            var Data = res.data;
            daofang(Data);
        })
        $(this).parent().parent().parent().parent().hide();
    })

    $('#daofangSearch').on('click', function () {
        var s = $('#daofangIpn').val();
        ajax.get('project/client/value', {search: s}, function (res) {
            var Data = res.data;
            daofang(Data);
        })
    })


    // 请求公司列表
    function PartyB(dom) {
        ajax.get('project/ruleCompany/sellList', {}, function (res) {
            var str = ''
            var data = res.data;
            for (var i = 0; i < data.length; i++) {
                str += '<option value="' + data[i].company_id + '">' + data[i].company_name + '</option>'
            }
            dom.append(str);
        })
    }

    //请求置业顾问列表
    function zhiye(dom) {
        ajax.get('project/client/getAdvicerList', {}, function (res) {
            var str = ''
            var data = res.data.rows;
            for (var i = 0; i < data.length; i++) {
                str += '<option value="' + data[i].RYXM + '">' + data[i].GSMC + '/' + data[i].RYXM + '/' + data[i].RYDH + '</option>'
            }
            dom.append(str);
        })
    }

    $('.closed').on('click', function () {
        $(this).parent().parent().parent().parent().hide();
    })
</script>
<!--日历插件-->
<script src="components/bootstrap-datepicker/dist/js/bootstrap-datepicker.js"></script>
<script src="components/bootstrap-timepicker/js/bootstrap-timepicker.js"></script>
<script src="components/moment/moment.js"></script>
<script src="components/bootstrap-daterangepicker/daterangepicker.js"></script>
<script src="components/eonasdan-bootstrap-datetimepicker/src/js/bootstrap-datetimepicker.js"></script>
<script src="components/fuelux/js/spinbox.js"></script>
<script>
    //日历插件初始化
    $('.date-picker').datepicker({
        autoclose: true,
        todayHighlight: true
    })
</script>

</body>

</html>